version: '3.8'
services:
  postgres:
    image: 'pgvector/pgvector:pg17'
    container_name: cognee-postgres
    restart: always
    environment:
      POSTGRES_USER: cognee
      POSTGRES_PASSWORD: '${POSTGRES_PASSWORD}'
      POSTGRES_DB: cognee_db
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U cognee"]
      interval: 10s
      timeout: 5s
      retries: 5
    volumes:
      - 'postgres_data:/var/lib/postgresql/data'
    networks:
      - cognee-network
  cognee:
    container_name: cognee-api
    restart: always
    build:
      context: .
      dockerfile: Dockerfile
    depends_on:
      postgres:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]  # Si tiene endpoint health, o usa "wget --quiet --tries=1 --spider http://localhost:8000"
      interval: 30s
      timeout: 10s
      retries: 5
    environment:
      ENV: dev
      DEBUG: false
      HOST: 0.0.0.0
      LOG_LEVEL: INFO
      CORS_ALLOWED_ORIGINS: 'https://cognee.lamaquina.club'
      UI_APP_URL: 'https://cognee.lamaquina.club'
      DATA_ROOT_DIRECTORY: /cognee_data
      S3_ACCESS_KEY: '${S3_ACCESS_KEY}'
      S3_SECRET_KEY: '${S3_SECRET_KEY}'
      S3_BUCKET_NAME: cognee-data
      S3_ENDPOINT: 'https://minio-api.lamaquina.club'
      AWS_ACCESS_KEY_ID: '${S3_ACCESS_KEY}'
      AWS_SECRET_ACCESS_KEY: '${S3_SECRET_KEY}'
      AWS_S3_BUCKET: cognee-data
      AWS_S3_ENDPOINT: 'https://minio-api.lamaquina.club'
      S3_USE_PATH_STYLE: 'true'
      DB_PROVIDER: postgres
      DB_HOST: postgres
      DB_PORT: 5432
      DB_USERNAME: cognee
      DB_PASSWORD: '${POSTGRES_PASSWORD}'
      DB_NAME: cognee_db
      VECTOR_DB_PROVIDER: pgvector
      VECTOR_DATASET_DATABASE_HANDLER: pgvector
      GRAPH_DATABASE_PROVIDER: kuzu
      GRAPH_DATASET_DATABASE_HANDLER: kuzu
      LLM_PROVIDER: custom
      LLM_ENDPOINT: 'https://openrouter.ai/api/v1'
      LLM_MODEL: '${LLM_MODEL}'
      LLM_API_KEY: '${OPENROUTER_API_KEY}'
      EMBEDDING_PROVIDER: openai
      EMBEDDING_MODEL: text-embedding-3-small
      EMBEDDING_API_KEY: '${OPENAI_API_KEY}'
      ACCEPT_LOCAL_FILE_PATH: false
      REQUIRE_AUTHENTICATION: false
      ENABLE_BACKEND_ACCESS_CONTROL: true
    volumes:
      - 'cognee_data:/cognee_data'
    networks:
      - cognee-network
    image: ''
  frontend:
    container_name: cognee-frontend
    restart: always
    build:
      context: ./cognee-frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_BACKEND_API_URL: https://api.cognee.lamaquina.club
    environment:
      NEXT_PUBLIC_BACKEND_API_URL: https://api.cognee.lamaquina.club
    networks:
      - cognee-network
networks:
  cognee-network:
    name: cognee-network
volumes:
  postgres_data: null
  cognee_data: null
